# ğŸ› ï¸ äº‘å¼€å‘æ§åˆ¶å°æ‰‹åŠ¨ä¿®å¤äº‘å‡½æ•°

## é—®é¢˜è¯´æ˜
è™½ç„¶äº‘å‡½æ•°æ˜¾ç¤ºå·²éƒ¨ç½²ï¼Œä½†ä¾ç„¶æŠ¥é”™ `Cannot find module 'wx-server-sdk'`ï¼Œè¯´æ˜ä¾èµ–åŒ…æ²¡æœ‰æ­£ç¡®å®‰è£…ã€‚

## æ‰‹åŠ¨ä¿®å¤æ­¥éª¤

### 1. è®¿é—®äº‘å¼€å‘æ§åˆ¶å°
- æ‰“å¼€ [https://console.cloud.tencent.com/tcb](https://console.cloud.tencent.com/tcb)
- é€‰æ‹©ç¯å¢ƒï¼š`ququer-env-6g35f0nv28c446e7`
- ç‚¹å‡»å·¦ä¾§èœå• "äº‘å‡½æ•°"

### 2. ä¿®å¤ createInvite äº‘å‡½æ•°

**æ­¥éª¤Aï¼šåˆ é™¤ç°æœ‰å‡½æ•°**
1. æ‰¾åˆ° `createInvite` å‡½æ•°
2. ç‚¹å‡»å³ä¾§ "åˆ é™¤" æŒ‰é’®
3. ç¡®è®¤åˆ é™¤

**æ­¥éª¤Bï¼šé‡æ–°åˆ›å»ºå‡½æ•°**
1. ç‚¹å‡» "æ–°å»º" æŒ‰é’®
2. å‡½æ•°åç§°ï¼š`createInvite`
3. è¿è¡Œç¯å¢ƒï¼š`Node.js 16`
4. åˆ›å»ºæ–¹å¼ï¼š`ç©ºç™½å‡½æ•°`

**æ­¥éª¤Cï¼šé…ç½®package.json**
åœ¨ "å‡½æ•°é…ç½®" æ ‡ç­¾é¡µï¼Œæ‰¾åˆ° package.json ç¼–è¾‘åŒºåŸŸï¼Œç²˜è´´ï¼š

```json
{
  "name": "createInvite",
  "version": "1.0.0",
  "description": "åˆ›å»ºèŠå¤©é‚€è¯·äº‘å‡½æ•°",
  "main": "index.js",
  "dependencies": {
    "wx-server-sdk": "~2.6.3"
  }
}
```

**æ­¥éª¤Dï¼šé…ç½®index.js**
åœ¨ "å‡½æ•°ä»£ç " æ ‡ç­¾é¡µï¼Œç²˜è´´å®Œæ•´ä»£ç ï¼š

```javascript
const cloud = require('wx-server-sdk')

cloud.init({
  env: 'ququer-env-6g35f0nv28c446e7'
})

const db = cloud.database()

exports.main = async (event, context) => {
  console.log('[createInvite] è¾“å…¥å‚æ•°:', event)
  
  try {
    const wxContext = cloud.getWXContext()
    const userId = event.inviter?.openId || wxContext.OPENID
    
    const chatId = event.chatId || 'chat_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9)
    
    const inviterInfo = {
      id: userId,
      openId: userId,
      nickName: event.inviter?.nickName || 'é‚€è¯·è€…',
      avatarUrl: event.inviter?.avatarUrl || '/assets/images/avatar1.png',
      isCreator: true,
      joinTime: db.serverDate()
    }
    
    const chatData = {
      status: 'waiting',
      inviter: inviterInfo,
      participants: [inviterInfo],
      chatStarted: false,
      createTime: db.serverDate(),
      updateTime: db.serverDate()
    }
    
    console.log('[createInvite] å‡†å¤‡åˆ›å»ºèŠå¤©:', chatId)
    
    await db.collection('conversations').doc(chatId).set({
      data: chatData
    })
    
    console.log('[createInvite] åˆ›å»ºæˆåŠŸ')
    
    return {
      success: true,
      chatId: chatId,
      inviter: inviterInfo,
      chat: chatData
    }
    
  } catch (error) {
    console.error('[createInvite] é”™è¯¯:', error)
    return {
      success: false,
      error: error.message
    }
  }
}
```

**æ­¥éª¤Eï¼šä¿å­˜å¹¶éƒ¨ç½²**
1. ç‚¹å‡» "ä¿å­˜å¹¶éƒ¨ç½²" æŒ‰é’®
2. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆçº¦1-2åˆ†é’Ÿï¼‰
3. ç¡®ä¿çŠ¶æ€æ˜¾ç¤ºä¸º "æ­£å¸¸"

### 3. éªŒè¯ä¿®å¤ç»“æœ

å›åˆ°å°ç¨‹åºæµ‹è¯•é¡µé¢ï¼Œé‡æ–°è¿è¡Œæµ‹è¯•ã€‚å¦‚æœæˆåŠŸï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
ğŸ§ª æµ‹è¯•æ—¥å¿—: âœ… createInviteè°ƒç”¨æˆåŠŸ
```

### 4. å¦‚æœå…¶ä»–äº‘å‡½æ•°ä¹Ÿæœ‰é—®é¢˜

æŒ‰ç…§ç›¸åŒæ–¹æ³•ï¼Œä¾æ¬¡ä¿®å¤ï¼š
- `joinByInvite`
- `checkChatStatus` 
- `startConversation`
- `login`

## å¿«é€Ÿä¿®å¤è„šæœ¬ï¼ˆå¤‡é€‰ï¼‰

å¦‚æœä¸Šè¿°æ–¹æ³•å¤ªç¹çï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ï¼š
1. åœ¨å¼€å‘è€…å·¥å…·ä¸­å…ˆåˆ é™¤æ‰€æœ‰äº‘å‡½æ•°
2. é‡æ–°è¿è¡Œæœ¬åœ°å®‰è£…è„šæœ¬
3. é‡æ–°éƒ¨ç½²æ‰€æœ‰äº‘å‡½æ•°

---

**âš¡ å…³é”®æé†’**ï¼š
- ç¡®ä¿é€‰æ‹©æ­£ç¡®çš„è¿è¡Œç¯å¢ƒï¼ˆNode.js 16ï¼‰
- ç¡®ä¿ package.json åŒ…å« wx-server-sdk ä¾èµ–
- ç­‰å¾…éƒ¨ç½²å®Œå…¨å®Œæˆå†æµ‹è¯• 