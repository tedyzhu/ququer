# ğŸ” éªŒè¯æ— é™å¾ªç¯ä¿®å¤æˆåŠŸ

## âœ… æ£€æŸ¥æ¸…å•

### 1. å¯åŠ¨éªŒè¯
- [ ] é‡æ–°æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
- [ ] é‡æ–°æ‰“å¼€é¡¹ç›®
- [ ] ç‚¹å‡»"ç¼–è¯‘"æŒ‰é’®
- [ ] ç­‰å¾…"ç¼–è¯‘æˆåŠŸ"æç¤º

### 2. æ—¥å¿—éªŒè¯
**æ­£ç¡®çš„æ—¥å¿—åº”è¯¥æ˜¾ç¤ºï¼š**
```
å®‰å…¨èŠå¤©é¡µé¢åŠ è½½ï¼Œå‚æ•°: {id: "xxx", ...}
```

**é”™è¯¯çš„æ—¥å¿—ï¼ˆä¸åº”è¯¥å‡ºç°ï¼‰ï¼š**
```
[é‚€è¯·æµç¨‹] å¼€å§‹åŠ è½½èŠå¤©ä¿¡æ¯
[é‚€è¯·æµç¨‹] ä»å…¨å±€æ•°æ®è·å–åˆ°èŠå¤©ä¿¡æ¯
[é‚€è¯·æµç¨‹] å¤„ç†èŠå¤©çŠ¶æ€: active
å¼€å§‹åŠ è½½èŠå¤©è®°å½•
```

### 3. é¡µé¢éªŒè¯
è¿›å…¥èŠå¤©é¡µé¢ååº”è¯¥çœ‹åˆ°ï¼š
- [ ] "âœ… å®‰å…¨èŠå¤©æ¨¡å¼å·²å¯ç”¨ï¼æ— é™å¾ªç¯é—®é¢˜å·²è§£å†³ã€‚" çš„ç³»ç»Ÿæ¶ˆæ¯
- [ ] "ä½ å¥½ï¼è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯ã€‚" çš„æ¨¡æ‹Ÿæ¶ˆæ¯
- [ ] å¯ä»¥æ­£å¸¸å‘é€æ–°æ¶ˆæ¯
- [ ] æ²¡æœ‰æ— é™å¾ªç¯çš„æ—¥å¿—

### 4. å¦‚æœéªŒè¯å¤±è´¥

#### é€‰é¡¹Aï¼šæ‰‹åŠ¨é‡å‘½åæ–‡ä»¶
```bash
cd app/pages/chat
mv chat.js chat.old.js
mv chat-safe.js chat.js
```

#### é€‰é¡¹Bï¼šå¼ºåˆ¶æ›¿æ¢å†…å®¹
1. æ‰“å¼€ `app/pages/chat/chat.js`
2. å…¨é€‰å†…å®¹å¹¶åˆ é™¤
3. å¤åˆ¶ `app/pages/chat/chat-safe.js` çš„å…¨éƒ¨å†…å®¹
4. ç²˜è´´å¹¶ä¿å­˜

#### é€‰é¡¹Cï¼šåˆ›å»ºæ–°é¡µé¢
å¦‚æœé—®é¢˜æŒç»­ï¼Œå¯ä»¥ï¼š
1. åˆ›å»º `app/pages/chat-new/` ç›®å½•
2. å¤åˆ¶å®‰å…¨ç‰ˆæœ¬åˆ°æ–°ç›®å½•
3. ä¿®æ”¹è·¯ç”±ä½¿ç”¨æ–°é¡µé¢

## ğŸš¨ ç´§æ€¥æƒ…å†µ

å¦‚æœä»¥ä¸Šéƒ½æ— æ•ˆï¼Œç«‹å³åœ¨æ§åˆ¶å°æ‰§è¡Œï¼š

```javascript
// å¼ºåˆ¶åœæ­¢æ‰€æœ‰å®šæ—¶å™¨å’Œå¾ªç¯
const timers = [];
const originalSetTimeout = setTimeout;
setTimeout = function(...args) {
  const timer = originalSetTimeout.apply(this, args);
  timers.push(timer);
  return timer;
};

// æ¸…ç†æ‰€æœ‰å®šæ—¶å™¨
timers.forEach(timer => clearTimeout(timer));

// é‡å†™é¡µé¢æ ˆ
const pages = getCurrentPages();
if (pages.length > 0) {
  const currentPage = pages[pages.length - 1];
  
  // å¼ºåˆ¶é‡å†™æ‰€æœ‰æ–¹æ³•
  currentPage.onLoad = function() { console.log('å·²é˜»æ­¢onLoad'); };
  currentPage.fetchMessages = function() { console.log('å·²é˜»æ­¢fetchMessages'); };
  
  wx.showToast({
    title: 'ç´§æ€¥ä¿®å¤å·²æ‰§è¡Œ',
    icon: 'success'
  });
}
``` 