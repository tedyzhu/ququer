# ğŸš€ è›æ›²å„¿å°ç¨‹åºäº‘å‡½æ•°éƒ¨ç½²å®Œæ•´æŒ‡å—

## é—®é¢˜è¯Šæ–­

å½“å‰é‡åˆ°çš„é—®é¢˜ï¼š`Cannot find module 'wx-server-sdk'`

**æ ¹æœ¬åŸå› **ï¼šäº‘å‡½æ•°ç¼ºå°‘å¿…éœ€çš„ä¾èµ–åŒ…ï¼Œéœ€è¦æ­£ç¡®å®‰è£…å’Œéƒ¨ç½²ã€‚

## è§£å†³æ–¹æ¡ˆé€‰æ‹©

### æ–¹æ¡ˆä¸€ï¼šå¾®ä¿¡å¼€å‘è€…å·¥å…·éƒ¨ç½²ï¼ˆæ¨èï¼‰

#### 1. ç¡®ä¿å¼€å‘è€…å·¥å…·é…ç½®æ­£ç¡®

æ£€æŸ¥ `project.config.json` æ–‡ä»¶ï¼š
```json
{
  "cloudfunctionRoot": "cloudfunctions/",
  "cloudbaseRoot": "cloudfunctions/"
}
```

#### 2. äº‘å‡½æ•°æœ¬åœ°å®‰è£…ä¾èµ–

åœ¨æ¯ä¸ªäº‘å‡½æ•°ç›®å½•ä¸‹è¿è¡Œï¼š
```bash
# ä»¥createInviteä¸ºä¾‹
cd cloudfunctions/createInvite
npm install
```

#### 3. å¾®ä¿¡å¼€å‘è€…å·¥å…·éƒ¨ç½²

1. åœ¨å¼€å‘è€…å·¥å…·ä¸­å³é”®ç‚¹å‡» `createInvite` æ–‡ä»¶å¤¹
2. é€‰æ‹© "ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–"
3. ç­‰å¾…éƒ¨ç½²å®Œæˆ

### æ–¹æ¡ˆäºŒï¼šäº‘å¼€å‘æ§åˆ¶å°æ‰‹åŠ¨åˆ›å»ºï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰

å¦‚æœå¼€å‘è€…å·¥å…·éƒ¨ç½²å¤±è´¥ï¼Œå¯ä»¥ç›´æ¥åœ¨äº‘å¼€å‘æ§åˆ¶å°åˆ›å»ºï¼š

#### å…³é”®äº‘å‡½æ•°åˆ—è¡¨

éœ€è¦éƒ¨ç½²çš„4ä¸ªæ ¸å¿ƒäº‘å‡½æ•°ï¼š

1. **createInvite** - åˆ›å»ºèŠå¤©é‚€è¯·
2. **joinByInvite** - åŠ å…¥é‚€è¯·èŠå¤©  
3. **checkChatStatus** - æ£€æŸ¥èŠå¤©çŠ¶æ€
4. **startConversation** - å¼€å§‹ä¼šè¯

#### createInvite äº‘å‡½æ•°å®Œæ•´é…ç½®

**package.json:**
```json
{
  "name": "createInvite",
  "version": "1.0.0",
  "description": "åˆ›å»ºèŠå¤©é‚€è¯·äº‘å‡½æ•°",
  "main": "index.js",
  "dependencies": {
    "wx-server-sdk": "~2.6.3"
  }
}
```

**index.js:** ï¼ˆå®Œæ•´ä»£ç è§ç°æœ‰æ–‡ä»¶ï¼‰

#### joinByInvite äº‘å‡½æ•°å®Œæ•´é…ç½®

**package.json:**
```json
{
  "name": "joinByInvite",
  "version": "1.0.0",
  "description": "åŠ å…¥èŠå¤©é‚€è¯·äº‘å‡½æ•°",
  "main": "index.js",
  "dependencies": {
    "wx-server-sdk": "~2.6.3"
  }
}
```

#### checkChatStatus äº‘å‡½æ•°å®Œæ•´é…ç½®

**package.json:**
```json
{
  "name": "checkChatStatus",
  "version": "1.0.0",
  "description": "æ£€æŸ¥èŠå¤©çŠ¶æ€äº‘å‡½æ•°",
  "main": "index.js",
  "dependencies": {
    "wx-server-sdk": "~2.6.3"
  }
}
```

#### startConversation äº‘å‡½æ•°å®Œæ•´é…ç½®

**package.json:**
```json
{
  "name": "startConversation",
  "version": "1.0.0",
  "description": "å¼€å§‹ä¼šè¯äº‘å‡½æ•°",
  "main": "index.js",
  "dependencies": {
    "wx-server-sdk": "~2.6.3"
  }
}
```

## å¿«é€Ÿéƒ¨ç½²è„šæœ¬

åˆ›å»ºæ‰¹é‡å®‰è£…ä¾èµ–çš„è„šæœ¬ï¼š

### install-dependencies.sh
```bash
#!/bin/bash
echo "ğŸ”§ å¼€å§‹ä¸ºæ‰€æœ‰äº‘å‡½æ•°å®‰è£…ä¾èµ–..."

functions=("createInvite" "joinByInvite" "checkChatStatus" "startConversation")

for func in "${functions[@]}"; do
    echo "ğŸ“¦ å®‰è£… $func ä¾èµ–..."
    cd "cloudfunctions/$func"
    npm install
    cd ../../
    echo "âœ… $func ä¾èµ–å®‰è£…å®Œæˆ"
done

echo "ğŸ‰ æ‰€æœ‰äº‘å‡½æ•°ä¾èµ–å®‰è£…å®Œæˆï¼"
```

## éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…æœ¬åœ°ä¾èµ–
```bash
# è¿è¡Œè„šæœ¬
chmod +x install-dependencies.sh
./install-dependencies.sh

# æˆ–æ‰‹åŠ¨å®‰è£…
cd cloudfunctions/createInvite && npm install && cd ../../
cd cloudfunctions/joinByInvite && npm install && cd ../../  
cd cloudfunctions/checkChatStatus && npm install && cd ../../
cd cloudfunctions/startConversation && npm install && cd ../../
```

### ç¬¬äºŒæ­¥ï¼šéƒ¨ç½²åˆ°äº‘ç«¯

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼š
1. å³é”®ç‚¹å‡»æ¯ä¸ªäº‘å‡½æ•°æ–‡ä»¶å¤¹
2. é€‰æ‹© "ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–"
3. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰

### ç¬¬ä¸‰æ­¥ï¼šéªŒè¯éƒ¨ç½²

åœ¨äº‘å¼€å‘æ§åˆ¶å°æŸ¥çœ‹ï¼š
1. ç™»å½• [cloud.tencent.com](https://cloud.tencent.com)
2. è¿›å…¥äº‘å¼€å‘æ§åˆ¶å°
3. é€‰æ‹©ç¯å¢ƒï¼š`ququer-env-6g35f0nv28c446e7`
4. æŸ¥çœ‹äº‘å‡½æ•°åˆ—è¡¨ï¼Œç¡®è®¤å‡½æ•°çŠ¶æ€ä¸º"æ­£å¸¸"

## æ•…éšœæ’é™¤

### å¦‚æœä¾ç„¶å¤±è´¥

1. **æ£€æŸ¥ç¯å¢ƒID**ï¼šç¡®ä¿æ‰€æœ‰æ–‡ä»¶ä¸­çš„ç¯å¢ƒIDä¸º `ququer-env-6g35f0nv28c446e7`
2. **æ£€æŸ¥æƒé™**ï¼šç¡®ä¿æœ‰äº‘å¼€å‘ç¯å¢ƒçš„ç®¡ç†æƒé™
3. **é‡æ–°åˆ›å»º**ï¼šåˆ é™¤ç°æœ‰äº‘å‡½æ•°ï¼Œé‡æ–°åˆ›å»º
4. **æŸ¥çœ‹æ—¥å¿—**ï¼šåœ¨äº‘å¼€å‘æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ³•

- **"FunctionName parameter could not be found"**ï¼šäº‘å‡½æ•°ä¸å­˜åœ¨ï¼Œéœ€è¦éƒ¨ç½²
- **"Cannot find module 'wx-server-sdk'"**ï¼šä¾èµ–åŒ…æœªå®‰è£…ï¼ŒæŒ‰ä¸Šè¿°æ­¥éª¤å®‰è£…
- **"äº‘å‡½æ•°æ‰§è¡Œè¶…æ—¶"**ï¼šæ£€æŸ¥ä»£ç é€»è¾‘ï¼Œå¯èƒ½æœ‰æ­»å¾ªç¯æˆ–èµ„æºé™åˆ¶

## å®Œæˆç¡®è®¤

éƒ¨ç½²å®Œæˆåï¼Œè¿è¡Œæµ‹è¯•é¡µé¢éªŒè¯åŠŸèƒ½ï¼š
1. è®¿é—® `pages/test-share/test-share`
2. ç‚¹å‡»"å¼€å§‹å®Œæ•´æµ‹è¯•"
3. æŸ¥çœ‹æ‰€æœ‰æ­¥éª¤æ˜¯å¦æ­£å¸¸æ‰§è¡Œ

---

**é‡è¦æé†’**ï¼š
- æ¯æ¬¡ä¿®æ”¹äº‘å‡½æ•°ä»£ç åéƒ½éœ€è¦é‡æ–°éƒ¨ç½²
- ä¿æŒæœ¬åœ°å’Œäº‘ç«¯ä»£ç åŒæ­¥
- å®šæœŸå¤‡ä»½äº‘å‡½æ•°ä»£ç  

## ğŸ‰ ä¿®å¤å®Œæˆï¼

### âœ… ä¸»è¦ä¿®å¤å†…å®¹ [[memory:5490447631744786023]]

**1. ç³»ç»Ÿæç¤ºå·®å¼‚åŒ–ä¿®å¤**
- âœ… **æ¥æ”¶æ–¹**ï¼šæ˜¾ç¤º"å·²åŠ å…¥xxçš„èŠå¤©"
- âœ… **å‘é€æ–¹**ï¼šæ˜¾ç¤º"å’Œxxå»ºç«‹äº†èŠå¤©" 
- âœ… å»æ‰äº†å†—ä½™çš„"æ­£åœ¨åŠ å…¥èŠå¤©..."ç³»ç»Ÿæç¤º

**2. æ¶ˆæ¯æ”¶å‘ä¸å¯¹ç§°é—®é¢˜ä¿®å¤**
- âœ… ä¿®å¤äº†æ¶ˆæ¯ç›‘å¬å™¨çš„ç”¨æˆ·OpenIdè·å–é€»è¾‘
- âœ… å¢å¼ºäº†æ¶ˆæ¯å½’å±åˆ¤æ–­ï¼Œæ›´å‡†ç¡®è¯†åˆ«è‡ªå·±/å¯¹æ–¹çš„æ¶ˆæ¯
- âœ… æ¥æ”¶æ–¹è¿æ¥åå¼ºåˆ¶é‡å¯ç›‘å¬å™¨ï¼Œç¡®ä¿èƒ½æ”¶åˆ°å‘é€æ–¹æ¶ˆæ¯
- âœ… å‘é€æ–¹ç›‘å¬å™¨å¢åŠ äº†ç³»ç»Ÿæ¶ˆæ¯å¤„ç†

**3. æ–°å¢å¼ºåŠ›è°ƒè¯•åŠŸèƒ½**
- âœ… æ–°å¢`forceMessageSync()`å¼ºåˆ¶æ¶ˆæ¯åŒæ­¥æ–¹æ³•
- âœ… ä¼˜åŒ–äº†ç°æœ‰çš„`testMessageSync()`æ–¹æ³•

### ğŸ§ª å¯ç”¨æµ‹è¯•å‘½ä»¤

ç°åœ¨å°ç¨‹åºä¸­å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æµ‹è¯•å‘½ä»¤ï¼š

```javascript
// åŸºç¡€åŠŸèƒ½æµ‹è¯•
getCurrentPages()[getCurrentPages().length - 1].testParticipantFix()    // å‚ä¸è€…ä¿®å¤
getCurrentPages()[getCurrentPages().length - 1].testTimeFix()           // æ—¶é—´å¤„ç†æµ‹è¯•  
getCurrentPages()[getCurrentPages().length - 1].testConnectionFix()     // è¿æ¥ä¿®å¤æµ‹è¯•

// æ¶ˆæ¯åŠŸèƒ½æµ‹è¯•
getCurrentPages()[getCurrentPages().length - 1].testMessageSync()       // æ¶ˆæ¯æ”¶å‘æµ‹è¯•
getCurrentPages()[getCurrentPages().length - 1].forceMessageSync()      // ğŸ†• å¼ºåˆ¶æ¶ˆæ¯åŒæ­¥
```

### ğŸ”§ ä¿®å¤åŸç†

**é—®é¢˜1è§£å†³æ–¹æ¡ˆ**ï¼š
- ä¿®æ”¹äº†`updateSystemMessageAfterJoin`æ–¹æ³•ï¼Œæ ¹æ®`isFromInvite`åˆ¤æ–­ç”¨æˆ·è§’è‰²
- åœ¨å‘é€æ–¹ç›‘å¬å™¨ä¸­å¢åŠ äº†"å’Œxxå»ºç«‹äº†èŠå¤©"çš„ç³»ç»Ÿæ¶ˆæ¯

**é—®é¢˜2è§£å†³æ–¹æ¡ˆ**ï¼š
- æ¶ˆæ¯ç›‘å¬å™¨ç°åœ¨ä¼˜å…ˆä½¿ç”¨é¡µé¢çº§çš„`currentUser.openId`è€Œä¸æ˜¯å…¨å±€æ•°æ®
- æ¥æ”¶æ–¹åŠ å…¥èŠå¤©åå¼ºåˆ¶é‡å¯æ¶ˆæ¯ç›‘å¬å™¨
- å¢å¼ºäº†æ¶ˆæ¯å½’å±åˆ¤æ–­é€»è¾‘ï¼Œé¿å…è¯¯åˆ¤

### ğŸ“Š é¢„æœŸæ•ˆæœ

- **ç³»ç»Ÿæç¤º**ï¼šåŒæ–¹å°†çœ‹åˆ°ä¸åŒçš„ã€è§’è‰²ç›¸å…³çš„ç³»ç»Ÿæç¤º
- **æ¶ˆæ¯æ”¶å‘**ï¼šå‘é€æ–¹å‘çš„æ¶ˆæ¯æ¥æ”¶æ–¹ç°åœ¨åº”è¯¥èƒ½æ­£å¸¸æ”¶åˆ°
- **å¯é æ€§**ï¼šåŒé‡ä¿éšœæœºåˆ¶ï¼ˆå®æ—¶ç›‘å¬+è½®è¯¢ï¼‰ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±

å¦‚æœä¿®å¤åä»æœ‰é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨`forceMessageSync()`å‘½ä»¤å¼ºåˆ¶é‡æ–°åŒæ­¥æ¶ˆæ¯ç³»ç»Ÿã€‚ 