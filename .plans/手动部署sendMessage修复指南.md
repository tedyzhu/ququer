# æ‰‹åŠ¨éƒ¨ç½²sendMessageäº‘å‡½æ•°ä¿®å¤æŒ‡å—

## ðŸš¨ ç´§æ€¥ä¿®å¤ï¼šsendMessageäº‘å‡½æ•°participantsè‡ªåŠ¨æ›´æ–°

### é—®é¢˜è¯´æ˜Ž
å½“å‰bå‘é€æ¶ˆæ¯æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨æ·»åŠ åˆ°participantsåˆ—è¡¨ï¼Œå¯¼è‡´açš„æ ‡é¢˜æ— æ³•æ›´æ–°ä¸º"æˆ‘å’Œxx(2)"æ ¼å¼ã€‚

### ä¿®å¤å†…å®¹
å·²åœ¨`cloudfunctions/sendMessage/index.js`ä¸­æ·»åŠ è‡ªåŠ¨æ£€æµ‹å’Œæ·»åŠ participantsçš„é€»è¾‘ã€‚

## ðŸ“‹ æ‰‹åŠ¨éƒ¨ç½²æ­¥éª¤

### æ–¹å¼1ï¼šä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼ˆæŽ¨èï¼‰

1. **æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·**
   - æ‰“å¼€é¡¹ç›®æ ¹ç›®å½•

2. **è¿›å…¥äº‘å¼€å‘æŽ§åˆ¶å°**
   - ç‚¹å‡»å·¥å…·æ ä¸­çš„"äº‘å¼€å‘"æŒ‰é’®
   - é€‰æ‹©çŽ¯å¢ƒï¼š`ququer-env-6g35f0nv28c446e7`

3. **ä¸Šä¼ äº‘å‡½æ•°**
   - åœ¨å·¦ä¾§æ–‡ä»¶åˆ—è¡¨ä¸­æ‰¾åˆ° `cloudfunctions/sendMessage`
   - å³é”®ç‚¹å‡» `sendMessage` æ–‡ä»¶å¤¹
   - é€‰æ‹©"ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–ï¼ˆä¸ä¸Šä¼ node_modulesï¼‰"
   - ç­‰å¾…éƒ¨ç½²å®Œæˆ

4. **éªŒè¯éƒ¨ç½²**
   - åœ¨äº‘å¼€å‘æŽ§åˆ¶å°çš„"äº‘å‡½æ•°"é¡µé¢
   - ç¡®è®¤`sendMessage`å‡½æ•°æ˜¾ç¤º"éƒ¨ç½²æˆåŠŸ"
   - æŸ¥çœ‹å‡½æ•°ä»£ç ï¼Œç¡®è®¤åŒ…å«æœ€æ–°çš„participantsæ›´æ–°é€»è¾‘

### æ–¹å¼2ï¼šä½¿ç”¨äº‘å¼€å‘æŽ§åˆ¶å°

1. **æ‰“å¼€è…¾è®¯äº‘äº‘å¼€å‘æŽ§åˆ¶å°**
   - è®¿é—®ï¼šhttps://console.cloud.tencent.com/tcb
   - é€‰æ‹©çŽ¯å¢ƒï¼š`ququer-env-6g35f0nv28c446e7`

2. **è¿›å…¥äº‘å‡½æ•°ç®¡ç†**
   - ç‚¹å‡»å·¦ä¾§èœå•"äº‘å‡½æ•°"
   - æ‰¾åˆ°`sendMessage`å‡½æ•°

3. **æ›´æ–°å‡½æ•°ä»£ç **
   - ç‚¹å‡»å‡½æ•°åè¿›å…¥è¯¦æƒ…é¡µ
   - ç‚¹å‡»"å‡½æ•°ä»£ç "æ ‡ç­¾
   - å°†æœ¬åœ°çš„`cloudfunctions/sendMessage/index.js`å†…å®¹å¤åˆ¶ç²˜è´´
   - ç‚¹å‡»"ä¿å­˜å¹¶éƒ¨ç½²"

### æ–¹å¼3ï¼šä½¿ç”¨å‘½ä»¤è¡Œï¼ˆéœ€è¦é…ç½®ï¼‰

å¦‚æžœä½ æƒ³ä½¿ç”¨å‘½ä»¤è¡Œï¼Œéœ€è¦å…ˆé…ç½®çŽ¯å¢ƒï¼š

```bash
# 1. åˆ›å»ºé…ç½®æ–‡ä»¶
cat > .cloudbaserc << EOF
{
  "version": "2.0",
  "envId": "ququer-env-6g35f0nv28c446e7"
}
EOF

# 2. ç™»å½•ï¼ˆéœ€è¦æ‰«ç ï¼‰
npx @cloudbase/cli login

# 3. éƒ¨ç½²å‡½æ•°
cd cloudfunctions/sendMessage
npx @cloudbase/cli functions:deploy sendMessage -e ququer-env-6g35f0nv28c446e7
```

## âœ… éªŒè¯éƒ¨ç½²æˆåŠŸ

### 1. æ£€æŸ¥äº‘å‡½æ•°æ—¥å¿—
- åœ¨äº‘å¼€å‘æŽ§åˆ¶å°æŸ¥çœ‹`sendMessage`å‡½æ•°çš„è°ƒç”¨æ—¥å¿—
- ç¡®è®¤æœ‰ç±»ä¼¼è¿™æ ·çš„æ—¥å¿—ï¼š
  ```
  ðŸ”¥ [sendMessage] æ£€æŸ¥å¹¶æ›´æ–°participantsåˆ—è¡¨
  ðŸ”¥ [sendMessage] ðŸ†˜ å‘é€è€…ä¸åœ¨participantsä¸­ï¼Œè‡ªåŠ¨æ·»åŠ 
  ðŸ”¥ [sendMessage] âœ… participantsåˆ—è¡¨å·²æ›´æ–°ï¼Œå‘é€è€…å·²æ·»åŠ 
  ```

### 2. åŠŸèƒ½æµ‹è¯•
1. **aåˆ›å»ºæ–°èŠå¤©**å¹¶åˆ†äº«é‚€è¯·é“¾æŽ¥
2. **båŠ å…¥èŠå¤©**å¹¶å‘é€æ¶ˆæ¯
3. **éªŒè¯æ•ˆæžœ**ï¼š
   - açš„æ ‡é¢˜åº”ç«‹å³æ›´æ–°ä¸º"æˆ‘å’Œbæ˜µç§°(2)"
   - åŒæ–¹æ¶ˆæ¯ä¼ é€’æ­£å¸¸
   - å‚ä¸Žè€…åˆ—è¡¨æ˜¾ç¤º2äºº

## ðŸš¨ å¦‚æžœéƒ¨ç½²åŽä»æœ‰é—®é¢˜

### æ£€æŸ¥æ¸…å•
- [ ] ç¡®è®¤`sendMessage`äº‘å‡½æ•°éƒ¨ç½²æˆåŠŸ
- [ ] æ£€æŸ¥äº‘å‡½æ•°è°ƒç”¨æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯
- [ ] ç¡®è®¤çŽ¯å¢ƒIDæ­£ç¡®ï¼š`ququer-env-6g35f0nv28c446e7`
- [ ] æ¸…é™¤å°ç¨‹åºç¼“å­˜é‡æ–°æµ‹è¯•

### å¿«é€ŸéªŒè¯ä¿®å¤
åœ¨èŠå¤©é¡µé¢æŽ§åˆ¶å°è¿è¡Œï¼š
```javascript
// æŸ¥çœ‹å½“å‰participantsæ•°é‡
console.log('å½“å‰participantsæ•°é‡:', getCurrentPages()[getCurrentPages().length-1].data.participants.length);
```

## ðŸ“ž éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æžœæ‰‹åŠ¨éƒ¨ç½²ä»æœ‰é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. éƒ¨ç½²è¿‡ç¨‹çš„æˆªå›¾æˆ–é”™è¯¯ä¿¡æ¯
2. äº‘å‡½æ•°è°ƒç”¨æ—¥å¿—
3. æµ‹è¯•æ—¶çš„æŽ§åˆ¶å°æ—¥å¿—

## ðŸŽ¯ ä¿®å¤åŽŸç†

æ­¤ä¿®å¤åœ¨`sendMessage`äº‘å‡½æ•°ä¸­æ·»åŠ äº†æ™ºèƒ½æ£€æµ‹ï¼š
1. æ¯æ¬¡å‘é€æ¶ˆæ¯æ—¶æ£€æŸ¥å‘é€è€…æ˜¯å¦åœ¨participantsä¸­
2. å¦‚æžœä¸åœ¨ï¼Œè‡ªåŠ¨èŽ·å–ç”¨æˆ·ä¿¡æ¯å¹¶æ·»åŠ åˆ°åˆ—è¡¨
3. æ›´æ–°conversationè®°å½•ï¼Œè§¦å‘å‰ç«¯ç›‘å¬å™¨
4. å‰ç«¯æ£€æµ‹åˆ°participantså˜åŒ–ï¼Œç«‹å³æ›´æ–°æ ‡é¢˜

è¿™æ ·ç¡®ä¿ä»»ä½•ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶éƒ½ä¼šè¢«æ­£ç¡®æ·»åŠ åˆ°å‚ä¸Žè€…åˆ—è¡¨ï¼Œè§£å†³æ ‡é¢˜æ›´æ–°é—®é¢˜ã€‚ 