# HOTFIX-v1.3.29 - 用户身份混淆和标题显示修复

## 问题描述

1. **用户身份混淆**：b的openId是`ojtOs7bA8w-ZdS1G_o5rdoeLzWDc`，但显示的昵称是"向冬"（a的昵称）
2. **标题显示错误**：
   - a显示："我和向冬（2）"（显示的是自己的昵称）
   - b显示："我和朋友"（显示的是邀请时的临时昵称）
3. **消息收发问题**：a的消息b收不到，但b的消息a能收到

## 根本原因分析

### 从日志分析的关键信息：
```
🔥 [发送方监听] 对方参与者信息: {
  id: "ojtOs7bA8w-ZdS1G_o5rdoeLzWDc", 
  openId: "ojtOs7bA8w-ZdS1G_o5rdoeLzWDc", 
  nickName: "向冬", // 这里是错误的，应该是b的真实昵称
  avatarUrl: "/assets/images/default-avatar.png"
}
```

### 问题根源：
1. **数据库污染**：users集合中可能存储了错误的用户信息
2. **前端信息传递问题**：currentUserInfo传递的信息可能不准确
3. **云函数获取逻辑问题**：从users集合获取用户信息时存在逻辑错误

## 修复方案

### 1. 修复sendMessage云函数（加强调试）

- 增加详细的调试日志
- 确保严格按照openId获取对应的用户信息
- 验证currentUserInfo的准确性

### 2. 修复前端用户信息获取逻辑

- 确保每个用户的真实信息被正确获取和传递
- 修复标题显示逻辑，确保显示对方的真实昵称

### 3. 创建用户数据清理工具

- 清理错误的用户数据
- 重新建立正确的用户-昵称映射关系

## 技术实现

### 修复优先级：
1. **紧急**：修复sendMessage云函数的用户信息获取逻辑
2. **重要**：修复前端标题显示逻辑
3. **必要**：创建数据清理工具

## 预期效果

修复后：
- a的标题显示："我和[b的真实昵称]（2）"
- b的标题显示："我和向冬（2）"
- 双向消息收发正常
- 用户身份信息准确无误 