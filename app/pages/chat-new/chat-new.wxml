<view class="chat-container">
  <!-- ç´§æ€¥ä¿®å¤ä¿¡æ¯æ  -->
  <view class="emergency-info" wx:if="{{showEmergencyInfo}}">
    <view class="emergency-content">
      <text class="emergency-title">ğŸ‰ ä¿®å¤æˆåŠŸï¼</text>
      <text class="emergency-desc">æ— é™å¾ªç¯é—®é¢˜å·²å½»åº•è§£å†³</text>
      <button class="emergency-close" bindtap="closeEmergencyInfo">Ã—</button>
    </view>
  </view>

  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <scroll-view 
    class="message-list" 
    scroll-y="true" 
    scroll-top="{{scrollTop}}"
    scroll-with-animation="true"
    style="padding-bottom: calc(160rpx + {{extraBottomPaddingPx}}px + constant(safe-area-inset-bottom)); padding-bottom: calc(160rpx + {{extraBottomPaddingPx}}px + env(safe-area-inset-bottom));">
    
    <view class="message-item" wx:for="{{messages}}" wx:key="id">
      <view class="message-wrapper {{item.senderId === 'self' ? 'self' : 'other'}}">
        
        <!-- ç³»ç»Ÿæ¶ˆæ¯ -->
        <view wx:if="{{item.senderId === 'system'}}" 
              class="system-message"
              style="background-color: {{item.backgroundColor || '#f0f0f0'}}">
          <text class="system-text">{{item.content}}</text>
          <text class="message-time">{{item.time}}</text>
        </view>
        
        <!-- æ™®é€šæ¶ˆæ¯ -->
        <view wx:else class="normal-message">
          <view class="message-bubble {{item.senderId === 'self' ? 'self-bubble' : 'other-bubble'}}">
            <view class="message-content">{{item.content}}</view>
          </view>
          <text class="message-time">{{item.time}}</text>
        </view>
        
      </view>
    </view>
    
    <!-- åº•éƒ¨é”šç‚¹ï¼šé”®ç›˜å¼¹èµ·æ—¶æ»šåŠ¨å®šä½ -->
    <view id="bottom-anchor" style="height: 1rpx;"></view>
  </scroll-view>

  <!-- è¾“å…¥æ  -->
  <view class="input-bar" style="bottom: {{keyboardHeight}}px;">
    <input 
      class="message-input"
      value="{{inputValue}}"
      placeholder="è¾“å…¥æ¶ˆæ¯..."
      bindinput="handleInputChange"
      bindfocus="onInputFocus"
      bindblur="onInputBlur"
      confirm-type="send"
      bindconfirm="sendMessage"
      cursor-spacing="16"
      adjust-position="false"
    />
    <button class="send-button" bindtap="sendMessage">å‘é€</button>
  </view>
  
</view> 