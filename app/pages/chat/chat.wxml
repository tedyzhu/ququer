<view class="chat-container">
  <!-- Ëá™ÂÆö‰πâÊ†áÈ¢òÊ†è -->
  <view class="custom-navbar">
    <view class="navbar-left" bindtap="showChatMenu">
      <text class="menu-icon">‚ãØ</text>
    </view>
    <view class="navbar-center">
      <view class="chat-title">{{dynamicTitle || 'Ê†áÈ¢òÂä†ËΩΩ‰∏≠...'}}</view>
      <!-- Ë∞ÉËØï‰ø°ÊÅØ -->
      <view wx:if="{{isDebugMode}}" style="font-size: 24rpx; color: #999;">
        DEBUG: {{dynamicTitle ? 'HAS_TITLE' : 'NO_TITLE'}}
      </view>
    </view>
    <view class="navbar-right">
      <!-- Âè≥‰æßÁïôÁ©∫ÔºåÈÅøÂÖç‰∏éÂ∞èÁ®ãÂ∫èÂÖ≥Èó≠ÊåâÈíÆÂÜ≤Á™Å -->
    </view>
  </view>

  <!-- ÈîÄÊØÅËÆ°Êó∂Âô® -->
  <view class="destroy-timer" wx:if="{{showDestroyTimer}}">
    <view class="timer-text">{{destroyTimerText}}</view>
  </view>
  
  <!-- ÂàõÂª∫ËÅäÂ§©Áä∂ÊÄÅ -->
  <view class="creating-chat-overlay" wx:if="{{isCreatingChat}}">
    <view class="creating-chat-content">
      <view class="creating-chat-spinner"></view>
      <text class="creating-chat-text">{{chatCreationStatus || 'Ê≠£Âú®ÂàõÂª∫ËÅäÂ§©...'}}</text>
    </view>
  </view>
  
  <!-- ËÅäÂ§©ÂÜÖÂÆπÂå∫Âüü -->
  <scroll-view
    class="messages-container"
    scroll-y="true"
    scroll-into-view="{{scrollIntoView}}"
    enable-flex="true"
    style="padding-bottom: {{bottomPaddingPx}}px;"
  >
    <!-- Ê≠£Âú®Âä†ËΩΩ -->
    <view wx:if="{{isLoading}}" class="loading-container">
      <view class="loading"></view>
      <text>Âä†ËΩΩ‰∏≠...</text>
    </view>
    
    <!-- Ê∂àÊÅØÂàóË°® -->
    <view wx:else class="messages-list">
      <block wx:for="{{messages}}" wx:key="id">
        <!-- Á≥ªÁªüÊ∂àÊÅØ -->
        <view 
          wx:if="{{item.isSystem}}"
          id="sys-{{index}}"
          class="message-wrapper system"
        >
          <view class="system-message">
            <text class="message-text">{{item.content}}</text>
          </view>
        </view>
        
        <!-- ÊôÆÈÄöÊ∂àÊÅØ - ÂæÆ‰ø°ÂéüÁîüÊ†∑Âºè -->
        <view 
          wx:else
          id="msg-{{index}}"
          class="message-item {{item.isSelf ? 'message-self' : 'message-other'}}"
          bindtap="onMessageTap"
          bindlongpress="onMessageLongTap"
          data-msgid="{{item.id}}"
        >
          <!-- Êó∂Èó¥ÊòæÁ§∫ -->
          <view wx:if="{{item.showTime}}" class="message-time-divider">
            <text class="time-text">{{item.timeDisplay}}</text>
          </view>
          
          <view class="message-row">
            <!-- üî• Á°Æ‰øùÊ≤°ÊúâÂ§¥ÂÉèÂÖÉÁ¥†Ê∏≤Êüì -->
            <!-- Ê∂àÊÅØÊ∞îÊ≥° -->
            <view class="message-bubble-wrapper {{item.isSelf ? 'self-bubble' : 'other-bubble'}}">
              <view 
                class="message-bubble {{item.destroying ? 'destroying' : ''}} {{item.fading ? 'fading' : ''}} {{item.destroyed ? 'destroyed' : ''}}"
                style="opacity: {{item.opacity !== undefined ? item.opacity : 1}}"
              >
                <!-- üî• Ê∂àÊÅØÂÜÖÂÆπÔºöÂ∑≤ÈîÄÊØÅÁöÑÊ∂àÊÅØÈöêËóèÂÜÖÂÆπ -->
                <view class="bubble-content" wx:if="{{!item.destroyed}}">{{item.content}}</view>
                <view class="bubble-content destroyed-content" wx:else>
                  <!-- Â∑≤ÈîÄÊØÅÁöÑÊ∂àÊÅØ‰∏çÊòæÁ§∫‰ªª‰ΩïÂÜÖÂÆπ -->
                </view>
                
                <!-- üî• ÈîÄÊØÅÂÄíËÆ°Êó∂ÊèêÁ§∫ - Â∑≤ÁßªÈô§ÊâÄÊúâÂÄíËÆ°Êó∂ÊòæÁ§∫ -->
                
                <!-- üî• ÁÇπÂáªÊü•ÁúãÊèêÁ§∫ - Â∑≤ÁßªÈô§ÔºåÁé∞Âú®ÈááÁî®Ëá™Âä®ÈîÄÊØÅÊñπÂºè -->
              </view>
            </view>
          </view>
        </view>
      </block>
      <!-- Â∫ïÈÉ®ÈîöÁÇπÔºöÈîÆÁõòÂºπËµ∑Êó∂ÊªöÂä®ÂÆö‰Ωç -->
      <view id="bottom-anchor" style="height: 1rpx;"></view>
    </view>
  </scroll-view>
  
  <!-- Â∫ïÈÉ®ËæìÂÖ•Âå∫Âüü -->
  <view class="input-container" style="bottom: {{keyboardHeight}}px;">
    <view class="voice-btn" bindtap="toggleVoiceInput">
      <image class="icon" src="/assets/images/mic.png" mode="aspectFit"></image>
    </view>
    
    <input
      class="message-input"
      type="text"
      placeholder="ËæìÂÖ•Ê∂àÊÅØ..."
      value="{{inputValue}}"
      bindinput="onInputChange"
      bindfocus="onInputFocus"
      bindblur="onInputBlur"
      confirm-type="send"
      bindconfirm="sendMessage"
      confirm-hold="true"
      cursor-spacing="16"
      adjust-position="false"
      disabled="{{isCreatingChat}}"
    />
    
    <view class="emoji-btn" bindtap="openEmojiPicker">
      <image class="icon" src="/assets/images/emoji.png" mode="aspectFit"></image>
    </view>
    
    <view class="more-btn" bindtap="openMoreFunctions">
      <image class="icon" src="/assets/images/more.png" mode="aspectFit"></image>
    </view>
    
    <view class="send-btn" bindtap="sendMessage" wx:if="{{inputValue.length > 0}}">ÂèëÈÄÅ</view>
  </view>
</view> 